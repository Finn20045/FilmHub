<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FilmHub</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
    <header>
        <div class="logo">FilmHub</div>
        <div class="profile">
            {% if user.is_authenticated %}
                <button class="nav-button" onclick="location.href='{% url 'profile' %}'">Профиль</button>
            {% else %}
                <button class="nav-button" onclick="location.href='{% url 'login' %}'">Войти</button>
            {% endif %}
        </div>
    </header>

    <main class="container">
        <!-- Боковая панель со списком комнат -->
        <aside class="sidebar">
            <h3>Доступные комнаты</h3>
            <ul id="room-list">
                {% for room in rooms %}
                    <li>
                        <strong>{{ room.name }}</strong> - {{ room.description }}
                        <button class="room-detail-button" data-room-name="{{ room.name }}">Подробнее</button>

                    </li>
                {% empty %}
                    <li>Нет доступных комнат.</li>
                {% endfor %}
            </ul>
        </aside>

        <!-- Основной контент -->
        <section id="main-content">
            {% if room %}
                <!-- Шапка комнаты -->
                <div id="room-header">
                    <h2>{{ room.name }}</h2>
                    <p>Владелец: {{ room.owner.username }}</p>
                    <p>Фильм: {{ room.video.title }}</p>
                    <button id="leave-room-button" data-room-name="{{ room_name|escape }}">Выйти из комнаты</button>

                </div>
                <!-- Плеер -->
                <video id="player" controls>
                    {% if current_video_url %}
                        <source src="{{ current_video_url }}" type="video/mp4">
                    {% else %}
                        <p>Видео недоступно.</p>
                    {% endif %}
                </video>


            {% else %}
                <!-- Список фильмов -->
                <div id="movie-list">
                    <h3>Список фильмов</h3>
                    {% for movie in movies %}
                        <div class="movie-card" onclick="showMovieDetails('{{ movie.id }}')">
                            <img src="{{ movie.poster_url }}" alt="{{ movie.title }}">
                            <p>{{ movie.title }}</p>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </section>
    </main>

    <!-- Скрытое поле для хранения выбранного фильма -->
    <input type="hidden" id="selected-movie-id" value="">


    <!-- Модальное окно для создания комнаты -->
    <div id="create-room-overlay" class="modal-overlay">
        <div id="create-room-modal" class="modal-content">
            <button class="close-button" onclick="closeCreateRoomModal()">×</button>
            <form id="create-room-form" method="post" action="/create_room/">
                {% csrf_token %}
                <label for="room-name">Название комнаты:</label>
                <input type="text" id="room-name" name="name" required>
                <label for="room-password">Пароль (опционально):</label>
                <input type="password" id="room-password" name="password">
                <label for="room-max-participants">Максимальное количество участников:</label>
                <input type="number" id="room-max-participants" name="max_participants" min="1" required>
                <label for="room-description">Описание:</label>
                <textarea id="room-description" name="description"></textarea>
                <!-- Поле для ID выбранного фильма -->
                <input type="hidden" id="room-movie-id" name="movie_id" value="">
                <button type="submit">Создать</button>
            </form>
        </div>
    </div>

    <!-- Модальное окно для информации о комнате -->
    <div id="room-modal-overlay" class="modal-overlay">
        <div id="room-modal" class="modal-content">
            <button class="close-button" onclick="closeRoomModal()">×</button>
            <h3 id="room-modal-name"></h3>
            <p id="room-modal-description"></p>
            <p>Участников: <span id="room-modal-participants"></span> / <span id="room-modal-max-participants"></span></p>
            <div id="room-modal-buttons">
                <button id="join-room-button" onclick="joinRoom()">Присоединиться</button>
                <button id="delete-room-button" style="display: none;" onclick="deleteRoom()">Удалить</button>
            </div>
        </div>
    </div>


    <!-- Модальное окно для информации о фильме -->
    <div id="movie-overlay" class="modal-overlay">
        <div id="movie-details-modal" class="modal-content">
            <button class="close-button" onclick="closeMovieDetailsModal()">×</button>
            <h3 id="movie-title"></h3>
            <img id="movie-poster" src="" alt="Постер фильма">
            <p id="movie-description"></p>
            <button id="watch-online-button" onclick="openCreateRoomModal()">Смотреть онлайн</button>
        </div>
    </div>

    <script id="room-data" type="application/json">
        {{ room|safe|escapejs }}
    </script>

    <script>
        const CURRENT_USER = "{{ request.user.username|escapejs }}";
    </script>
    
    
    <script src="{% static 'js/scripts.js' %}"></script>
</body>
</html>
